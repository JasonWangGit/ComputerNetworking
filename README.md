# 计算机网络（韩立刚）

## 第 1 章 概述

#### 术语

- 结点（node）
  - 二叉树中叫节点，网络中叫结点
- 链路（link）
- 主机（host）
- 互联网（internet）
- 因特网（Internet）
  - 当前全球最大的、开放的、由众多网络相互连接而成的特定计算机网络，它采用 TCP/IP 协议族作为通信的规则
- 因特网服务提供者ISP（Internet Service Provider）
- 万维网WWW（World Wide Web）

### 1.1 因特网的组成

#### 因特网的边缘部分与核心部分

- 边缘部分：由所有连接在因特网上的主机（端系统 end system）组成
  - 两种通信方式
    - 客户服务器方式（C/S 方式）：Client/Server，客户是服务的请求方，服务器是服务的提供方
    - 对等方式（P2P 方式）：Peer-to-Peer，两个主机在通信时并不区分哪一个是服务请求方还是服务提供方
- 核心部分：由大量网络和连接这些网络的路由器组成
  - 在网络核心部分起特殊作用的是路由器（router）
    - 路由器是实现分组交换（packet switching）的关键构件，其任务是转发收到的分组

### 1.2 计算机网络的性能

#### 计算机网络的性能指标

- 比特（bit）是计算机中数据量的单位，也是信息论中使用的信息量的单位
  - bit 来源于binary digit，意思是一个“二进制数字”，因此一个比特就是二进制数字中的 一个1或0
- **速率**即数据率（data rate）或比特率（bit rate）是计算机网络中最重要的一个性能指标。速率的单位是 b/s，或kb/s, Mb/s, Gb/s 等
- **带宽**（bandwidth）本来是指信号具有的频带宽度，单位是赫（或千赫、兆赫、 吉赫等）
  - 现在“带宽”是数字信道所能传送的 “最高数据率”的同义语，单位是“比特每秒”，或 b/s (bit/s)

$$
在计算机界，K = 2^{10} = 1024， M = 2^{20}， G = 2^{30}， T = 2^{40}
$$

- **吞吐量**（throughput）表示在单位时间内通过某个网络（或信道、接口）的数据量

- **时延**（delay或 latency）

  - 总时延 = 发送时延 + 传播时延 + 处理时延 + 处理时延
  - 传输时延（发送时延）：发送数据时， 数据块从结点进入到传输媒体所需要的时间
    - 发送时延 = 数据块长度（比特） / 信道带宽（比特/秒）

  - 传播时延：电磁波在信道中需要传播一定的距离而花费的时间
    - 传播时延 = 信道长度（米） / 信号在信道上的传播速率（米/秒）
  - 处理时延：交换结点为存储转发而进行一些必要的处理所花费的时间
  - 排队时延：结点缓存队列中分组排队所经历的时延

- 链路的**时延带宽积**又称为以比特为单位的链路长度

  - 时延带宽积 = 传播时延 × 带宽

- **利用率**

  - 信道利用率指出某信道有百分之几的时间是被利用的（有数据通过）
    - 完全空闲的信道的利用率是零
  - 网络利用率则是全网络的信道利用率的加权平均值
  - 根据排队论的理论，当某信道的利用率增大时，该信道引起的时延也就迅速增加

### 1.3 计算机网络的体系结构

#### 分层的好处（解耦）

- 各层之间是独立的
- 灵活性好
- 结构上可分割开
- 易于实现和维护
- 能促进标准化工作

#### OSI

- 应用层（Application）
  - 能够产生网络流量且能和用户交互的应用程序

- 表示层（Presentation）
  - 加密、压缩

- 会话层（Session）
  - 服务器和客户端建立的会话
- 传输层（Transport）
  - 可靠传输、不可靠传输

- 网络层（Network）
  - IP地址编址、选择最路径

- 数据链路层（Data Link）
  - 封装数据、添加物理层地址（MAC）

- 物理层（Physical）
  - 电压、接口标准

#### TCP/IP

- 应用层（Application）
  - 应用层 + 表示层 + 会话层
- 运输层（Transport）
- 网际层（Internet）
  - 网络层
- 网络接口层（Network Access）
  - 数据链路层 + 物理层

#### 五层协议

- 应用层（Application）
- 运输层（Transport）
- 网络层（Network）
- 数据链路层（Data Link）
- 物理层（Physical）

<img src="D:\Program Files\sts-bundle\source\ComputerNetworking\image\主机1向主机2发送数据.png" alt="主机1向主机2发送数据" style="zoom:30%;" />

<img src="D:\Program Files\sts-bundle\source\ComputerNetworking\image\IP over Everything.png" alt="IP over Everything" style="zoom:30%;" />

## 第 2 章 物理层

### 2.1 物理层的基本概念

物理层的主要任务描述为确定与传输媒体的接口的一些特性。

- 机械特性：指明接口所用接线器的形状和尺寸 、引线数目和排列、固定和锁定装置等等
- 电气特性：指明在接口电缆的各条线上出现的电压的范围
- 功能特性：指明某条线上出现的某一电平的电压表示何种意义
- 过程特性：指明对于不同功能的各种可能事件的出现顺序

### 2.2 数据通信的基础知识

#### 数据通信系统的模型

<img src="D:\Program Files\sts-bundle\source\ComputerNetworking\image\数据通信系统的模型.png" alt="数据通信系统的模型" style="zoom:30%;" />

#### 术语

- 数据(data)
- 信号(signal)
- 模拟的(analogous)
- 数字的(digital)
- 码元(code)：在使用时间域（或简称为时域）的波形表示数字信号时，代表不同离散数值的基本波形

#### 有关信号的几个基本概念

- 单向通信（单工通信）
- 双向交替通信（半双工通信）
- 双向同时通信（全双工通信）

#### 基带(baseband)信号和带通(band pass)信号

- 基带信号（即基本频带信号）
- 带通信号：把基带信号经过载波调制后，把信号的频率范围搬移到较高的频段以便在信道中传输（即仅在一 段频率范围内能够通过信道）

#### 几种最基本的调制方法

- 调幅(AM)
  - 正交振幅调制 QAM (Quadrature Amplitude Modulation)
- 调频(FM)
- 调相(PM) 

#### 奈氏准则

- 1924 年，奈奎斯特(Nyquist)就推导出了著名的奈氏准则
- 他给出了在假定的理想条件下，为了避免码间串扰，码元的传输速率的上限值
- 在任何信道中，码元传输的速率是有上限的， 否则就会出现码间串扰的问题，使接收端对码元的判决（即识别）成为不可能

#### 香农公式

- 香农(Shannon)用信息论的理论推导出了带宽受限且有高斯白噪声干扰的信道的极限、无差错的信息传输速率
- 信道的极限信息传输速率 C 可表达为

$$
C = log_2(1 + S / N)
$$

- W 为信道的带宽（以 Hz 为单位）
- S 为信道内所传信号的平均功率
- N 为信道内部的高斯噪声功率

##### 香农公式表明

- 信道的带宽或信道中的信噪比越大，则信息的极限传输速率就越高
- 只要信息传输速率低于信道的极限信息传输速率，就一定可以找到某种办法来实现无差错的传输
- 若信道带宽 W 或信噪比 S/N 没有上限（当然实际信道不可能是这样的）
  - 则信道的极限信息传输速率 C 也就没有上限
- 实际信道上能够达到的信息传输速率要比香农的极限传输速率低不少
- 对于频带宽度已确定的信道，如果信噪比不能再提高了，并且码元传输速率也达到了上限值，那么还有办法提高信息的传输速率
  - 这就是用编码的方法让每一个码元携带更多比特的信息量

### 2.3 物理层下面的传输媒体

#### 导向传输媒体

- 双绞线 
  - 屏蔽双绞线 STP (Shielded Twisted Pair) 
  - 无屏蔽双绞线 UTP (Unshielded Twisted Pair) 
- 同轴电缆 
  - 50 Ω同轴电缆 
  - 75 Ω同轴电缆 
- 光缆
  - 多模光纤
  - 单模光纤

#### 非导向传输媒体

- 短波通信主要是靠电离层的反射，但短波信道的通信质量较差
- 微波在空间主要是直线传播
  - 地面微波接力通信
  - 卫星通信

### 2.4 信道复用技术

- 频分复用FDM (Frequency Division Multiplexing)

- 时分复用TDM (Time Division Multiplexing) 
  - 时分复用可能会造成线路资源的浪费

- 统计时分复用STDM (Statistic TDM) 
  - 避免时分复用的浪费
- 波分复用 WDM (Wavelength Division Multiplexing)
  - 波分复用就是光的频分复用
- 码分复用 CDM (Code Division Multiplexing)
  - 码分多址 CDMA (Code Division Multiple Access)
    - 各用户使用经过特殊挑选的不同码型，因此彼此不会造成干扰
    - 这种系统发送的信号有很强的抗干扰能力， 其频谱类似于白噪声，不易被敌人发现
    - 每一个比特时间划分为 m 个短的间隔，称为码片(chip)
    - 每个站分配的码片序列不仅必须各不相同， 并且还必须互相正交(orthogonal)
    - 在实用的系统中是使用伪随机码序列

### 2.5 数字传输系统

- 脉码调制 PCM 体制
  - 脉码调制 PCM 体制最初是为了在电话局之间的中继线上传送多路的电话
- 同步光纤网 SONET 和同步数字系列 SDH 
  - 一般可认为 SDH 与 SONET 是同义词

### 2.6 宽带接入技术

- xDSL 技术
  - 就是用数字技术对现有的模拟电话用户线进行改造，使它能够承载宽带业务
- 光纤同轴混合网 HFC (Hybrid Fiber Coax)
  - HFC 网是在目前覆盖面很广的有线电视网 CATV 的基础上开发的一种居民宽带接入网
- FTTx 技术
  - FTTx（光纤到……）也是一种实现宽带居民接入网的方案

## 第 3 章 数据链路层

数据链路层使用的信道主要有以下两种类型：

- 点对点信道：这种信道使用一对一的点 对点通信方式
- 广播信道：这种信道使用一对多的广播通信方式，因此过程比较复杂
  - 广播信道上连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据收发

### 3.1 使用点对点信道的数据链路层

#### 数据链路和帧

- 链路(link)是一条无源的点到点的物理线路段，中间没有任何其他的交换结点
  - 一条链路只是一条通路的一个组成部分
- 数据链路(data link) 除了物理线路外，还必须有通信协议来控制这些数据的传输
  - 现在最常用的方法是使用适配器（即网卡）来实现 这些协议的硬件和软件
    - 一般的适配器都包括了数据链路层和物理层这两层的功能。
  - 若把实现这些协议的硬件和软件加到链路上，就构成了数据链路
  - 数据链路层传送的是帧

#### 三个基本问题

- 封装成帧
  - 封装成帧(framing)就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧
    - 确定帧的界限
  - 首部和尾部的一个重要作用就是进行帧定界
- 透明传输
  - 发送端的数据链路层在数据中出现控制字符 “SOH”或“EOT”的前面插入一个转义字符 “ESC”(其十六进制编码是 1B)
  - 字节填充(byte stuffing)或字符填充(character stuffing)
    - 接收端的数据链路层在将数据送往网络层之前删除插入的转义字符
  - 如果转义字符也出现数据当中，那么应在转义字符前面插入一个转义字符
    - 当接收端收到连续的两个转义字符时，就删除其中前面的一个
- 差错控制
  - 在传输过程中可能会产生比特差错：1 可能会变成 0 而 0 也可能变成 1
  - 在一段时间内，传输错误的比特占所传输比特总数的比率称为误码率 BER (Bit Error Rate)
    - 误码率与信噪比有很大的关系
  - 在数据链路层传送的帧中，广泛使用了循环冗余检验 CRC 的检错技术
    - 在数据后面添加上的冗余码称为帧检验序列 FCS (Frame Check Sequence)
      - CRC 是一种常用的检错方法，而 FCS 是添加在数据后面的冗余码
      - FCS 可以用 CRC 这种方法得出，但 CRC 并非用来获得 FCS 的唯一方法
    - 仅用循环冗余检验 CRC 差错检测技术只能做到无差错接受(accept)
    - “无差错接受”是指：“凡是接受的帧（即不包括丢弃的帧），我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错” 。 
      - 也就是说：“凡是接收端数据链路层接受的帧都没有传输差错”（有差错的帧就丢弃而不接受）
    - 要做到“可靠传输”（即发送什么就收到什么） 就必须再加上确认和重传机制。

### 3.2 点对点协议 PPP

现在全世界使用得最多的数据链路层协议是点对点协议 PPP (Point-to-Point Protocol)。

- 用户使用拨号电话线接入因特网时，一般都是使用 PPP 协议

#### PPP 协议的组成

-  一个将 IP 数据报封装到串行链路的方法 
- 链路控制协议 LCP (Link Control Protocol)
- 网络控制协议 NCP (Network Control Protocol)

#### PPP 协议的帧格式

<img src="D:\Program Files\sts-bundle\source\ComputerNetworking\image\PPP协议的帧格式.png" alt="PPP协议的帧格式" style="zoom:30%;" />

#### 透明传输问题

- 当 PPP 用在同步传输链路时，协议规定采用硬件来完成比特填充（和 HDLC 的 做法一样）
  - PPP 协议用在 SONET/SDH 链路时，是使用同步传输（一连串的比特连续传送）
    - 这时 PPP 协议采用零比特填充方法来实现透明传输
      - 在发送端，只要发现有 5 个连续 1，则立即填入一个 0
- 当 PPP 用在异步传输时，就使用一种特殊的字符填充法
  - 将信息字段中出现的每一个 0x7E 字节转变成为 2 字节序列(0x7D, 0x5E)
  - 若信息字段中出现 ASCII 码的控制字符（即数值小于 0x20 的字符），则在该字符前面要加入一个 0x7D 字节，同时将该字符的编码加以改变

### 3.3 使用广播信道的数据链路层

#### 局域网的数据链路层

局域网最主要的特点是：网络为一个单位所拥有，且地理范围和站点数目均有限。

##### 媒体共享技术

- 静态划分信道 
  - 频分复用、时分复用、波分复用、码分复用 
- 动态媒体接入控制（多点接入） 
  - 随机接入 
  - 受控接入，如多点线路探询(polling)，或轮询

##### 以太网的两个标准

- DIX Ethernet V2
- IEEE 802.3（简称为以太网）

##### 数据链路层的两个子层

- ~~逻辑链路控制 LLC（Logical Link Control）子层~~
- 媒体接入控制 MAC（Medium Access Control）子层

##### 适配器的作用

网络接口板又称为通信适配器(adapter) 或网络接口卡 NIC (Network Interface Card)，或“网卡”。

- 进行串行/并行转换
- 对数据进行缓存
- 在计算机的操作系统安装设备驱动程序
- 实现以太网协议

<img src="D:\Program Files\sts-bundle\source\ComputerNetworking\image\计算机通过适配器和局域网进行通信.png" alt="计算机通过适配器和局域网进行通信" style="zoom:30%;" />

#### CSMA/CD 协议

最初的以太网是将许多计算机都连接到一根总线上。当初认为这样的连接方法既简单又可靠， 因为总线上没有有源器件。

##### 以太网的广播方式发送

总线上的每一个工作的计算机都能检测到 B 发送的数据信号。

##### 为了通信的简便以太网采取了两种重要的措施

- 采用较为灵活的无连接的工作方式，即 不必先建立连接就可以直接发送数据
- 以太网对发送的数据帧不进行编号，也 不要求对方发回确认
  - 这样做的理由是局域网信道的质量很好，因 信道质量产生差错的概率是很小的

##### 以太网提供的服务：曼彻斯特(Manchester)编码

- 以太网提供的服务是不可靠的交付，即尽最大努力的交付 
- 当目的站收到有差错的数据帧时就丢弃此帧，其他什么也不做
  - 差错的纠正由高层来决定。 
  - 如果高层发现丢失了一些数据而进行重 传，但以太网并不知道这是一个重传的帧，而是当作一个新的数据帧来发送

##### 载波监听多点接入/碰撞检测 CSMA/CD（Carrier Sense Multiple Access with Collision Detection）

- “多点接入”表示许多计算机以多点接入的方 式连接在一根总线上。 
- “载波监听”是指每一个站在发送数据之前先 要检测一下总线上是否有其他计算机在发送数据
  - 如果有，则暂时不要发送数据，以免发生碰撞
  - 总线上并没有什么“载波”
    - 因此， “载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号
- “碰撞检测”就是计算机边发送数据边检测信道 上的信号电压大小
  - 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）
    - 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在 发送数据，表明产生了碰撞
  - 所谓“碰撞”就是发生了冲突
    - 因此“碰撞检测”也称为“冲突检测”
  - 每一个正在发送数据的站，一旦发现总线上出现了碰撞，就要立即停止发送， 免得继续浪费网络资源，然后等待一段随机时间后再次发送
  - 争用期（碰撞窗口）
    - 最先发送数据帧的站，在发送数据帧后至多经过时间 2τ（两倍的端到端往返时延） 就可知道发送的数据帧是否遭受了碰撞
  - 二进制指数类型退避算法（truncated binary exponential type）
    - 发生碰撞的站在停止发送数据后，要推迟（退避）一个随机时间才能再发送数据
  - 最短有效帧长（64 字节）
    - 以太网取 51.2 μs 为争用期的长度
    - 对于 10 Mb/s 以太网，在争用期内可发送 512 bit，即 64 字节
    - 以太网在发送数据时，若前 64 字节没有发生冲突，则后续的数据就不会发生冲突
    - 如果发生冲突，就一定是在发送的前 64 字节之内
    - 由于一检测到冲突就立即中止发送，这时已经发送出去的数据一定小于 64 字节
    - 以太网规定了最短有效帧长为 64 字节，凡长度小于 64 字节的帧都是由于冲突而异常中止的无效帧
  - 强化碰撞
    - 当发送数据的站一旦发现发生了碰撞时： 
      - 立即停止发送数据
      - 再继续发送若干比特的人为干扰信号(jamming signal)，以便让所有用户都知道现在已经发生了碰撞

##### 重要特性

- 使用 CSMA/CD 协议的以太网不能进行全双工通信而只能进行双向交替通信（半双工通信）

### 3.4 使用广播信道的以太网

#### 使用集线器的星形拓扑

- 传统以太网最初是使用粗同轴电缆，后来演进到使用比较便宜的细同轴电缆，最后发展为使用更便宜和更灵活的双绞线
- 这种以太网采用星形拓扑，在星形的中心则增加了一种可靠性非常高的设备，叫做集线器(hub) 

##### 集线器的一些特点

- 集线器是使用电子器件来模拟实际电缆线的工作，因此整个系统仍然像一个传统的以太网那样运行
- 使用集线器的以太网在逻辑上仍是一个总线网，各工作站使用的还是 CSMA/CD 协议，并共享逻辑上的总线
- 集线器很像一个多接口的转发器，工作在物理层

#### 以太网的 MAC 层

在局域网中，硬件地址又称为物理地址， 或 MAC 地址。

### 3.5 扩展的以太网

### 3.6 高速以太网

### 3.7 其他类型的高速局域网接口